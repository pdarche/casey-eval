{% extends "base.html" %}

{% block title %}Clone {{ source.version }} - Prompt Versions - Casey Eval{% endblock %}

{% block content %}
<div class="mb-6">
    <div class="flex items-center text-sm text-gray-500 mb-2">
        <a href="/prompts" class="hover:text-blue-600">Prompts</a>
        <span class="mx-2">/</span>
        <a href="/prompts/{{ source.id }}" class="hover:text-blue-600">{{ source.version }}</a>
        <span class="mx-2">/</span>
        <span>Clone</span>
    </div>
    <h1 class="text-2xl font-bold text-gray-800">Clone Prompt Version</h1>
    <p class="text-gray-600 mt-1">Create a new version based on {{ source.version }}</p>
</div>

<div class="bg-white rounded-lg shadow p-6">
    <form id="clone-form" method="POST" action="/api/prompts">
        <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">New Version *</label>
                    <input
                        type="text"
                        name="version"
                        required
                        placeholder="e.g., v1.2 or v2.0-beta"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-gray-500">Cloning from: {{ source.version }}</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                    <input
                        type="text"
                        name="name"
                        value="{{ source.name or '' }}"
                        placeholder="e.g., Casey Intake Agent - Updated"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Prompt Content (YAML) *</label>
                <textarea
                    name="content"
                    required
                    rows="30"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm">{{ source.content }}</textarea>
                <p class="mt-1 text-sm text-gray-500">Edit the prompt content as needed</p>
            </div>

            <div class="flex items-center">
                <input
                    type="checkbox"
                    name="is_active"
                    id="is_active"
                    class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                <label for="is_active" class="ml-2 block text-sm text-gray-700">
                    Set as active version (will deactivate {{ source.version }})
                </label>
            </div>
        </div>

        <div class="mt-6 flex justify-end space-x-3">
            <a href="/prompts/{{ source.id }}"
               class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                Cancel
            </a>
            <button
                type="submit"
                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium">
                Create Cloned Version
            </button>
        </div>
    </form>
</div>

<script>
document.getElementById('clone-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = new FormData(this);
    const data = {
        version: formData.get('version'),
        name: formData.get('name'),
        content: formData.get('content'),
        is_active: formData.get('is_active') === 'on'
    };

    try {
        const response = await fetch('/api/prompts', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            const result = await response.json();
            window.location.href = '/prompts/' + result.id;
        } else {
            const error = await response.json();
            alert('Error: ' + (error.error || 'Failed to create prompt'));
        }
    } catch (err) {
        alert('Error: ' + err.message);
    }
});
</script>
{% endblock %}
